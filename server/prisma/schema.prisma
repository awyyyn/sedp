
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model SystemUser {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  email String @unique
  firstName String
  lastName String
  middleName String?
  password String
  mfaSecret String?
  phoneNumber String
  birthDate DateTime
  gender Gender
  mfaEnabled Boolean @default(false) 
  address address 
  role SystemUserRole
  status SystemUserStatus @default(UNVERIFIED)
  verifiedAt DateTime?

  transactions Transactions[]
  announcements Announcement[]

  // TimeStamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("system_users")
}

enum SystemUserStatus {
  PENDING
  VERIFIED
  UNVERIFIED
  DELETED
}

enum SystemUserRole {
  SUPER_ADMIN
  ADMIN_MANAGE_SCHOLAR
  ADMIN_MANAGE_GATHERINGS
  ADMIN_MANAGE_DOCUMENTS
  ADMIN_VIEWER
}

model Student {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId

  email String @unique
  firstName String
  lastName String 
  middleName String?
  address address
  password String
  gender Gender
  birthDate DateTime
  phoneNumber String
  status StudentStatus @default(SCHOLAR)

  mfaSecret String?
  mfaEnabled Boolean @default(false) 

  yearLevel Int 
  schoolName String 
  course String @default("") 

  statusUpdatedAt DateTime? 

  documents documents[]

  // TimeStamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("students")
}

enum Gender {
  MALE
  FEMALE
}

type address {
  street String
  city String 
}

enum StudentStatus {
  REQUESTING
  SCHOLAR
  GRADUATED
  DISQUALIFIED
  ARCHIVED
}

 
model token {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  email String @unique
  token String
  time  DateTime  

  @@map("tokens")
}

enum documentTypeEnum {
  photo
  document
}

model documents {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  student Student @relation(fields: [studentId], references: [id])
  studentId String  @db.ObjectId
  documentType documentTypeEnum @default(photo)
  documentName String
  documentUrl String 

  

  // TimeStamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("documents")
}

model Events {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId

  title String
  description String
  startTime String
  endTime String
  location String
  startDate String
  endDate String

  createdAt DateTime@default(now())
  @@map("events")
}

model Announcement {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId

  title String
  content String
  createdBy SystemUser   @relation(references: [id], fields: [createdById])
  createdById String @db.ObjectId 

  createdAt DateTime @default(now())

  @@map("announcements")
}

model Meeting {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId

  title String
  description String

  startTime String
  endTime String
  location String
  date DateTime

  createdAt DateTime @default(now())

  @@map("meetings")
}


model Transactions {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  transaction String
  transactionId String @db.ObjectId

  userId String @db.ObjectId
  user SystemUser @relation(references: [id], fields: [userId])

  createdAt DateTime @default(now())
}

